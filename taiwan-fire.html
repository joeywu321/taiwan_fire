<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç£ç‰ˆ FIRE è²¡å‹™è‡ªç”±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/2.1.0/chartjs-plugin-annotation.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Microsoft JhengHei', sans-serif; background-color: #f1f5f9; }
        .toggle-checkbox:checked { right: 0; border-color: #ef4444; }
        .toggle-checkbox:checked + .toggle-label { background-color: #ef4444; }
        input[type=number]::-webkit-inner-spin-button { opacity: 1; }
    </style>
</head>
<body class="pb-12 text-slate-800">

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <div class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900">ğŸ‡¹ğŸ‡¼ å°ç£è²¡å‹™è‡ªç”±è¨ˆç®—å™¨</h1>
        <!-- <p class="mt-2 text-slate-600">å‹ä¿/å‹é€€/åœ‹ä¿å…¨ç´å…¥ Â· æé ˜å¹´é½¡å½ˆæ€§è©¦ç®— Â· æ¶ˆè²»é€šè†¨æ›²ç·š</p> -->
    </div>

    <div class="grid grid-cols-1 xl:grid-cols-12 gap-6">

        <div class="xl:col-span-4 space-y-5">

            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                <h3 class="font-bold text-slate-700 mb-3 flex items-center"><i class="fas fa-user-clock text-indigo-500 mr-2"></i>åŸºæœ¬è¨­å®š</h3>
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <div>
                        <label class="text-xs text-slate-500">ç›®å‰å¹´é½¡</label>
                        <input type="number" id="age" value="43" class="w-full border rounded px-2 py-1 bg-slate-50 font-bold" onchange="runAnalysis()">
                    </div>
                    <div>
                        <label class="text-xs text-slate-500">é ä¼°å£½å‘½ (å¯æ‰‹å‹•)</label>
                        <input type="number" id="lifeExpectancyInput" value="85" class="w-full border rounded px-2 py-1 bg-white border-indigo-200 text-indigo-700 font-bold" onchange="runAnalysis()">
                    </div>
                </div>
                <div class="text-[10px] text-gray-400">
                    * ç³»çµ±é è¨­ 85 æ­²ï¼Œå»ºè­°è¼¸å…¥ 90-95 æ­²é€²è¡Œé•·å£½é¢¨éšªæ¸¬è©¦ã€‚
                </div>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                <h3 class="font-bold text-slate-700 mb-3 flex items-center"><i class="fas fa-wallet text-green-600 mr-2"></i>é–‹éŠ·è¨­å®š</h3>

                <div class="mb-3">
                    <select id="citySelect" class="w-full border rounded p-2 text-sm bg-slate-50" onchange="updateExpenseData()">
                        <optgroup label="å…­éƒ½">
                            <option value="Taipei">å°åŒ—å¸‚</option>
                            <option value="NewTaipei">æ–°åŒ—å¸‚</option>
                            <option value="Taoyuan">æ¡ƒåœ’å¸‚</option>
                            <option value="Taichung">å°ä¸­å¸‚</option>
                            <option value="Tainan">å°å—å¸‚</option>
                            <option value="Kaohsiung">é«˜é›„å¸‚</option>
                        </optgroup>
                        <optgroup label="å…¶ä»–ç¸£å¸‚">
                            <option value="Other">å…¶ä»–ç¸£å¸‚(å¹³å‡)</option>
                        </optgroup>
                    </select>
                </div>

                <div class="bg-red-50 p-3 rounded border border-red-100 mb-3" id="modeContainer">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-bold text-red-800" id="modeLabel">ç”Ÿå­˜æ¨¡å¼ (æœ€ä½ç”Ÿæ´»è²»)</label>
                        <div class="relative inline-block w-10 mr-2 align-middle select-none">
                            <input type="checkbox" name="toggle" id="survivalToggle" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-gray-300" onchange="updateExpenseData()"/>
                            <label for="survivalToggle" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer"></label>
                        </div>
                    </div>
                </div>

                <div>
                    <label class="text-xs text-slate-500">æ¯æœˆé ä¼°ç¸½æ”¯å‡º</label>
                    <div class="relative">
                        <span class="absolute left-3 top-2 text-gray-500">$</span>
                        <input type="number" id="monthlyExpense" class="w-full border rounded p-2 pl-7 font-bold text-lg text-slate-700" value="0" onchange="runAnalysis()">
                    </div>
                </div>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                <h3 class="font-bold text-slate-700 mb-3 flex items-center"><i class="fas fa-coins text-yellow-500 mr-2"></i>è³‡ç”¢é…ç½®</h3>
                <div class="space-y-3">
                    <div>
                        <label class="text-xs text-slate-500">ç›®å‰ç¸½æ·¨è³‡ç”¢</label>
                        <input type="number" id="assets" value="11000000" class="w-full border rounded p-2 bg-slate-50" onchange="runAnalysis()">
                    </div>
                    <div>
                        <label class="text-xs text-slate-500 text-blue-600 font-bold">æ¯å¹´å†æŠ•å…¥é‡‘é¡ (ç›´åˆ°65æ­²é€€ä¼‘)</label>
                        <input type="number" id="annualContribution" value="0" class="w-full border border-blue-200 rounded p-2 bg-blue-50 text-blue-800" placeholder="ä¾‹å¦‚ï¼š120000" onchange="runAnalysis()">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs text-slate-500">å¹´åŒ–å ±é…¬ç‡ (%)</label>
                            <input type="number" id="roi" value="4.5" class="w-full border rounded p-2" onchange="runAnalysis()">
                        </div>
                        <div>
                            <label class="text-xs text-slate-500">é ä¼°é€šè†¨ç‡ (%)</label>
                            <input type="number" id="inflation" value="2.5" class="w-full border rounded p-2 text-red-600" onchange="runAnalysis()">
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="runAnalysis()" class="w-full bg-slate-800 text-white font-bold py-3 rounded-lg hover:bg-slate-900 transition shadow-lg">
                æ›´æ–°å ±è¡¨
            </button>
        </div>

        <div class="xl:col-span-8 space-y-6">

            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200">
                <h3 class="font-bold text-slate-700 mb-4 border-b pb-2 flex justify-between">
                    <span>ğŸ§® é€€ä¼‘é‡‘ä¸‰å¤§æ”¯æŸ±è¨­å®š</span>
                    <span class="text-xs font-normal text-gray-500 mt-1">æé ˜å¹´é½¡å¯ä¿®æ”¹ï¼Œä½æ–¼æ³•å®šæœƒæ¸›é¡</span>
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-bold text-blue-800 text-sm">1. å‹ä¿å¹´é‡‘</h4>
                            <input type="number" id="lbStartAge" value="65" min="60" max="70" class="w-12 text-xs border border-blue-300 rounded text-center font-bold text-blue-700" title="æé ˜å¹´é½¡" onchange="runAnalysis()">
                            <span class="text-xs text-blue-600">æ­²é ˜</span>
                        </div>
                        <div class="space-y-2">
                            <div>
                                <label class="text-[10px] text-gray-500 block">æœ€é«˜60å€‹æœˆå¹³å‡è–ªè³‡ (ä¸Šé™45,800)</label>
                                <input id="lbSalary" type="number" value="45800" max="45800" class="w-full text-xs border rounded p-1 bg-white" onchange="checkMaxSalary(this); runAnalysis()">
                            </div>
                            <div>
                                <label class="text-[10px] text-gray-500 block">ç´¯è¨ˆå¹´è³‡</label>
                                <input id="lbYears" type="number" value="15" class="w-full text-xs border rounded p-1 bg-white" onchange="runAnalysis()">
                            </div>
                        </div>
                        <div class="mt-2 pt-2 border-t border-blue-200 flex justify-between">
                            <span class="text-xs text-gray-500">é ä¼°æœˆé ˜:</span>
                            <span class="text-sm font-bold text-blue-700" id="lbResult">--</span>
                        </div>
                        <div class="text-[10px] text-blue-400 mt-1" id="lbNote">æ¨™æº–é¡åº¦</div>
                    </div>

                    <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-bold text-green-800 text-sm">2. å‹å·¥é€€ä¼‘é‡‘</h4>
                            <input type="number" id="lpStartAge" value="60" min="60" class="w-12 text-xs border border-green-300 rounded text-center font-bold text-green-700" title="æé ˜å¹´é½¡" onchange="runAnalysis()">
                            <span class="text-xs text-green-600">æ­²é ˜</span>
                        </div>
                        <div class="space-y-2">
                            <div>
                                <label class="text-[10px] text-gray-500 block">ç›®å‰å°ˆæˆ¶ç´¯ç©ç¸½é¡</label>
                                <input id="lpPot" type="number" value="860000" class="w-full text-xs border rounded p-1 bg-white" onchange="runAnalysis()">
                            </div>
                            <div class="text-[10px] text-green-600 pt-5 leading-tight">
                                * æ³•å®š60æ­²å¯é ˜<br>å‡è¨­å¹´åŒ– 3% æ»¾å­˜
                            </div>
                        </div>
                        <div class="mt-2 pt-2 border-t border-green-200 flex justify-between">
                            <span class="text-xs text-gray-500">é ä¼°æœˆé ˜:</span>
                            <span class="text-sm font-bold text-green-700" id="lpResult">--</span>
                        </div>
                    </div>

                    <div class="bg-orange-50 p-3 rounded-lg border border-orange-200">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-bold text-orange-800 text-sm">3. åœ‹æ°‘å¹´é‡‘</h4>
                            <input type="number" id="npStartAge" value="65" min="65" disabled class="w-12 text-xs border border-orange-300 bg-orange-100 rounded text-center font-bold text-gray-500" title="æ³•å®š65æ­²">
                            <span class="text-xs text-orange-600">æ­²é ˜</span>
                        </div>
                        <div class="space-y-2">
                            <div>
                                <label class="text-[10px] text-gray-500 block">ç´¯è¨ˆç´ä¿å¹´è³‡ (å¹´)</label>
                                <input id="npYears" type="number" value="22" class="w-full text-xs border rounded p-1 bg-white" onchange="runAnalysis()">
                            </div>
                            <div class="text-[10px] text-orange-600 pt-1 leading-tight">
                                * æ¡ç”¨ B å¼ (æœ€å„ªå¼)<br>æœˆæŠ•ä¿é¡ $19,761
                            </div>
                        </div>
                        <div class="mt-4 pt-2 border-t border-orange-200 flex justify-between">
                            <span class="text-xs text-gray-500">é ä¼°æœˆé ˜:</span>
                            <span class="text-sm font-bold text-orange-700" id="npResult">--</span>
                        </div>
                    </div>

                </div>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 h-[500px]">
                <canvas id="fireChart"></canvas>
            </div>

            <div id="conclusion" class="hidden p-6 rounded-xl shadow-lg">
                <div class="flex items-start">
                    <div class="flex-shrink-0" id="conclusionIcon"></div>
                    <div class="ml-4">
                        <h3 class="text-xl font-bold text-white" id="conclusionTitle"></h3>
                        <p class="mt-2 text-white text-sm leading-relaxed opacity-90" id="conclusionText"></p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="mt-8 text-center text-xs text-gray-400">
        è³‡æ–™ä¾†æºï¼šè¡›ç¦éƒ¨ 114 å¹´æœ€ä½ç”Ÿæ´»è²»ã€çµ±è¨ˆè³‡è¨Šç¶² 113 å¹´å¹³å‡æ¯äººæœˆæ¶ˆè²»ã€å‹ä¿å±€ (å‹ä¿/åœ‹ä¿) çµ¦ä»˜è©¦ç®—å…¬å¼ã€‚
    </div>

</div>

<script>
    // --- 114å¹´ (2025) å„ç¸£å¸‚æœ€ä½ç”Ÿæ´»è²» (Survival) èˆ‡ é ä¼°ä¸€èˆ¬æ¶ˆè²» (Normal) ---
    const cityData = {
        'Taipei':       { normal: 34952, survival: 24455 },
        'NewTaipei':    { normal: 27557, survival: 20280 },
        'Taoyuan':      { normal: 25718, survival: 20122 },
        'Taichung':     { normal: 28754, survival: 19292 },
        'Tainan':       { normal: 23036, survival: 18618 },
        'Kaohsiung':    { normal: 26722, survival: 19248 },
        'Other':        { normal: 23011, survival: 18618 }
    };

    let myChart = null;
    const NP_INSURED_AMOUNT = 19761; // 112å¹´èµ·åœ‹ä¿æœˆæŠ•ä¿é‡‘é¡

    window.onload = function() {
        updateExpenseData();
    };

    // 1. å¼·åˆ¶é™åˆ¶å‹ä¿æŠ•ä¿è–ªè³‡ä¸Šé™
    function checkMaxSalary(input) {
        if (parseInt(input.value) > 45800) {
            input.value = 45800;
            alert("å‹ä¿æœ€é«˜æŠ•ä¿è–ªè³‡ä¸Šé™ç‚º 45,800 å…ƒ");
        }
    }

    // 2. æ›´æ–°é–‹éŠ·
    function updateExpenseData() {
        const city = document.getElementById('citySelect').value;
        const isSurvival = document.getElementById('survivalToggle').checked;
        const data = cityData[city] || cityData['Other'];

        const expense = isSurvival ? data.survival : data.normal;

        // æ›´æ–° UI
        const modeLabel = document.getElementById('modeLabel');
        const modeContainer = document.getElementById('modeContainer');
        if (isSurvival) {
            modeLabel.innerText = "ç”Ÿå­˜æ¨¡å¼ (è¡›ç¦éƒ¨æœ€ä½æ¨™æº–)";
            modeContainer.className = "bg-red-50 p-3 rounded border border-red-200 mb-3";
        } else {
            modeLabel.innerText = "ä¸€èˆ¬æ¨¡å¼ (å¹³å‡æ¶ˆè²»æ°´æº–)";
            modeContainer.className = "bg-gray-50 p-3 rounded border border-gray-200 mb-3";
        }
        document.getElementById('monthlyExpense').value = expense;
        runAnalysis();
    }

    function formatMoney(n) {
        return "$" + new Intl.NumberFormat('zh-TW').format(Math.round(n));
    }

    // 3. æ ¸å¿ƒé‹ç®—
    function runAnalysis() {
        // --- A. è®€å–åŸºç¤åƒæ•¸ ---
        const currentAge = parseInt(document.getElementById('age').value);
        const lifeExpectancy = parseInt(document.getElementById('lifeExpectancyInput').value);
        let assets = parseFloat(document.getElementById('assets').value);
        const annualContribution = parseFloat(document.getElementById('annualContribution').value) || 0;
        const monthlyExpenseBase = parseFloat(document.getElementById('monthlyExpense').value);
        const roi = parseFloat(document.getElementById('roi').value) / 100;
        const inflation = parseFloat(document.getElementById('inflation').value) / 100;

        // --- B. è®€å–é€€ä¼‘é‡‘åƒæ•¸ ---
        // 1. å‹ä¿
        const lbStartAge = parseInt(document.getElementById('lbStartAge').value); // æé ˜å¹´é½¡
        const lbSalary = Math.min(parseFloat(document.getElementById('lbSalary').value), 45800);
        const lbYears = parseFloat(document.getElementById('lbYears').value);

        // 2. å‹é€€
        const lpStartAge = parseInt(document.getElementById('lpStartAge').value);
        const lpPot = parseFloat(document.getElementById('lpPot').value);

        // 3. åœ‹ä¿
        const npStartAge = 65; // åœ‹ä¿æ³•å®š65æ­²ï¼Œä¸å¯ææ—©
        const npYears = parseFloat(document.getElementById('npYears').value);

        // --- C. è¨ˆç®—æ¯æœˆé€€ä¼‘é‡‘ (éœæ…‹è©¦ç®—) ---

        // C1. å‹ä¿è¨ˆç®— (å«å±•å»¶/æ¸›çµ¦æ©Ÿåˆ¶)
        // æ³•å®š65æ­²ã€‚æ¯ææ—©1å¹´æ¸›4%ï¼Œæ¯å»¶å¾Œ1å¹´å¢4%ã€‚(æœ€å¤š+/- 20%)
        let lbRate = 0.0155;
        let lbBonus = 0;
        if (lbStartAge < 65) {
            lbBonus = (lbStartAge - 65) * 0.04; // è² å€¼
        } else if (lbStartAge > 65) {
            lbBonus = (lbStartAge - 65) * 0.04; // æ­£å€¼
        }
        // é™åˆ¶ç¯„åœ -20% ~ +20%
        if (lbBonus < -0.2) lbBonus = -0.2;
        if (lbBonus > 0.2) lbBonus = 0.2;

        const lbBaseMonthly = lbSalary * lbYears * lbRate;
        const lbFinalMonthly = Math.round(lbBaseMonthly * (1 + lbBonus));

        // æ›´æ–° UI é¡¯ç¤ºèˆ‡å‚™è¨»
        document.getElementById('lbResult').innerText = formatMoney(lbFinalMonthly);
        let lbNoteText = "æ¨™æº–é¡åº¦";
        if(lbBonus > 0) lbNoteText = `å±•å»¶å¹´é‡‘ (+${(lbBonus*100).toFixed(0)}%)`;
        if(lbBonus < 0) lbNoteText = `æ¸›çµ¦å¹´é‡‘ (${(lbBonus*100).toFixed(0)}%)`;
        document.getElementById('lbNote').innerText = lbNoteText;
        document.getElementById('lbNote').className = lbBonus >= 0 ? "text-[10px] text-green-600 mt-1" : "text-[10px] text-red-500 mt-1";

        // C2. å‹é€€è¨ˆç®— (è¤‡åˆ©æ»¾å­˜è‡³æé ˜å¹´é½¡)
        // å‡è¨­å¾ç¾åœ¨(currentAge) æ»¾å­˜åˆ° lpStartAge
        const yearsToLp = lpStartAge - currentAge;
        let futureLpPot = lpPot;
        if (yearsToLp > 0) {
            futureLpPot = lpPot * Math.pow(1.03, yearsToLp);
        }
        // ç°¡å–®æ”¤æ (ä»¥å¹³å‡é¤˜å‘½20å¹´è¨ˆ, 240å€‹æœˆ)
        const lpFinalMonthly = Math.round(futureLpPot / 240);
        document.getElementById('lpResult').innerText = formatMoney(lpFinalMonthly);

        // C3. åœ‹ä¿è¨ˆç®— (Bå¼ï¼šæœˆæŠ•ä¿é‡‘é¡ Ã— å¹´è³‡ Ã— 1.3%)
        // æœ‰å‹ä¿å¹´é‡‘è€…ï¼Œé€šå¸¸é©ç”¨Bå¼
        const npFinalMonthly = Math.round(NP_INSURED_AMOUNT * npYears * 0.013);
        document.getElementById('npResult').innerText = formatMoney(npFinalMonthly);


        // --- D. é€å¹´ç¾é‡‘æµæ¨¡æ“¬ ---
        let labels = [];
        let dataAssets = [];
        let dataExpenses = []; // æ–°å¢ï¼šæ¶ˆè²»ç·šæ•¸æ“š

        let simAge = currentAge;
        let tempAssets = assets;
        let brokeAge = null;
        let finalAge = lifeExpectancy + 5; // å¤šç•«5å¹´

        while (simAge <= finalAge) {
            labels.push(simAge);
            dataAssets.push(Math.round(tempAssets));

            // 1. è¨ˆç®—ç•¶å¹´åº¦ç¸½æ”¯å‡º (é€šè†¨å¾Œ)
            let annualExpense = monthlyExpenseBase * 12 * Math.pow(1 + inflation, simAge - currentAge);
            dataExpenses.push(Math.round(annualExpense)); // ç´€éŒ„æ¶ˆè²»ç·š

            // 2. è¨ˆç®—ç•¶å¹´åº¦ç¸½æ”¶å…¥ (é€€ä¼‘é‡‘)
            let annualPension = 0;

            // å‹ä¿
            if (simAge >= lbStartAge) annualPension += (lbFinalMonthly * 12);
            // å‹é€€
            if (simAge >= lpStartAge) annualPension += (lpFinalMonthly * 12);
            // åœ‹ä¿
            if (simAge >= npStartAge) annualPension += (npFinalMonthly * 12);

            // 3. é¡å¤–æŠ•å…¥ (åƒ…é™ 65 æ­²å‰ï¼Œæˆ–è¨­ä¸€å€‹å·¥ä½œæˆªæ­¢é½¡ï¼Œé€™è£¡å‡è¨­åˆ°65)
            let contribution = 0;
            if (simAge < 65) contribution = annualContribution;

            // 4. æ·¨ç¾é‡‘æµ
            let netCashFlow = annualPension + contribution - annualExpense;

            // 5. è³‡ç”¢è®Šå‹•
            if (tempAssets >= 0) {
                // ((æœŸåˆè³‡ç”¢ + æ·¨ç¾é‡‘æµ) * (1+å ±é…¬ç‡))
                tempAssets = ((tempAssets+ netCashFlow) * (1 + roi));
            }

            if (tempAssets <= 0) {
                if (!brokeAge) brokeAge = simAge;
                tempAssets = 0;
            }

            simAge++;
        }

        drawChart(labels, dataAssets, dataExpenses, currentAge, lifeExpectancy);
        updateConclusion(brokeAge, lifeExpectancy, dataAssets[lifeExpectancy - currentAge]);
    }

    // æ›´æ–°çµè«–å¡ç‰‡
    function updateConclusion(brokeAge, deathAge, finalAssets) {
        const div = document.getElementById('conclusion');
        const title = document.getElementById('conclusionTitle');
        const text = document.getElementById('conclusionText');
        const icon = document.getElementById('conclusionIcon');

        div.classList.remove('hidden');

        if (brokeAge && brokeAge < deathAge) {
            div.className = "bg-red-900 p-6 rounded-xl shadow-lg";
            icon.innerHTML = '<i class="fas fa-exclamation-triangle text-yellow-400 text-3xl mt-1"></i>';
            title.innerText = "è³‡ç”¢æ¯ç«­è­¦å ±";
            text.innerHTML = `è³‡ç”¢é è¨ˆåœ¨ <strong>${brokeAge} æ­²</strong> è€—ç›¡ã€‚<br>å»ºè­°ï¼š<br>1. å»¶å¾Œå‹ä¿æé ˜å¹´é½¡ (è³ºå–å±•å»¶å¹´é‡‘)<br>2. å¢åŠ å…¼è·æ”¶å…¥<br>3. åˆ‡æ›è‡³ç”Ÿå­˜æ¨¡å¼é–‹éŠ·`;
        } else {
            div.className = "bg-slate-800 p-6 rounded-xl shadow-lg";
            icon.innerHTML = '<i class="fas fa-check-circle text-green-400 text-3xl mt-1"></i>';
            title.innerText = "è²¡å‹™è‡ªç”±é”æˆ";
            text.innerHTML = `è³‡ç”¢è¶³ä»¥æ”¯æ’è‡³ <strong>${deathAge} æ­²</strong>ï¼Œå±†æ™‚é ä¼°å‰©é¤˜ <strong>${formatMoney(finalAssets)}</strong>ã€‚<br>å³ä½¿æ¶ˆè²»éš¨é€šè†¨ä¸Šå‡ï¼Œæ‚¨çš„é€€ä¼‘é‡‘çµ„åˆæä¾›äº†è‰¯å¥½çš„é˜²ç¦¦ã€‚`;
        }
    }

    // ç¹ªåœ– (é›™Yè»¸)
    function drawChart(labels, assetsData, expensesData, startAge, deathAge) {
        const ctx = document.getElementById('fireChart').getContext('2d');

        const dataLength = deathAge - startAge + 1;
        const displayLabels = labels.slice(0, dataLength);

        if (myChart) myChart.destroy();

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                // labels: labels,
                labels: displayLabels,
                datasets: [
                    {
                        label: 'ç¸½æ·¨è³‡ç”¢',
                        data: assetsData,
                        borderColor: '#4f46e5', // Indigo
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        yAxisID: 'y',
                        pointRadius: 0,
                        pointHoverRadius: 5
                    },
                    {
                        label: 'å¹´åº¦ç¸½æ¶ˆè²»',
                        data: expensesData,
                        borderColor: '#ef4444', // Red
                        backgroundColor: 'rgba(239, 68, 68, 0.05)',
                        borderDash: [5, 5],
                        fill: false,
                        yAxisID: 'y', // å³è»¸
                        tension: 0.4,
                        pointRadius: 0
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    annotation: {
                        annotations: {
                            line1: {
                                type: 'line',
                                //xMin: deathAge - startAge,
                                //xMax: deathAge - startAge,
                                xMin: dataLength-1,
                                xMax: dataLength-1,

                                borderColor: 'rgba(255, 255, 255, 0.5)',
                                borderWidth: 2,
                                borderDash: [2, 2],
                                label: { display: true, content: 'å£½å‘½çµ‚é»', position: 'start', color: 'white', backgroundColor: 'rgba(0,0,0,0.5)' }
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + formatMoney(context.raw);
                            },
                            title: function(context) {
                                return context[0].label + " æ­²";
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false }
                    },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: 'ç¸½è³‡ç”¢ (TWD)' },
                        ticks: { callback: function(value) { return (value/10000).toFixed(0) + 'è¬'; } }
                    },
                }
            }
        });
    }
</script>

</body>
</html>